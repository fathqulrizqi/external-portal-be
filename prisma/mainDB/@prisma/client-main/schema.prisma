model CompanySegment {
  segmentId   Int                  @id @default(autoincrement())
  segmentName String               @unique @db.VarChar(100)
  description String?              @db.VarChar(255)
  companies   CompanySegmentLink[]
}

model Company {
  companyId      String               @id @default(uuid()) @db.Uuid
  urlImage       String?
  companyName    String?
  companyStatus  String? //will be used for differentiating between active, inactive, blacklisted, etc.
  companyTelpFax String?
  companyCity    String?
  companyAddress String?
  companyEmail   String?
  npwp           String? //tax identification number
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  companyCode    String? //unique company code/id used internally
  companyType    String? //will be used for differentiating between vendor, consultant, contractor, etc.
  application    String               @default("External Portal")
  segments       CompanySegmentLink[]
  profile        Profile[] //relation to Profile/user model
  formL9         FormL9?

  @@index([companyName])
  @@index([npwp])
  @@index([companyEmail])
}

model CompanySegmentLink {
  id        Int            @id @default(autoincrement())
  companyId String         @db.Uuid
  segmentId Int
  company   Company        @relation(fields: [companyId], references: [companyId])
  segment   CompanySegment @relation(fields: [segmentId], references: [segmentId])

  @@unique([companyId, segmentId])
}

model Distro_PO_Incentive {
  id         Int      @id @default(autoincrement())
  rangeFrom  Int
  rangeTo    Int
  vehicle    String
  vehicleId  String
  periodYear Int
  amount     Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model Distro_PO_Header {
  id              Int              @id @default(autoincrement())
  poNumber        String           @unique
  distributorName String
  customerCode    String
  poDate          DateTime
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  niterraPO       String           @unique
  niterraSO       String           @unique
  uuid            String           @unique @default(uuid())
  items           Distro_PO_Line[]

  @@map("Distro_PO_Header")
}

model Distro_PO_Line {
  id              Int              @id @default(autoincrement())
  vehicle         String
  vehicleId       String
  category        String
  spType          String
  partName        String
  partNumber      String
  qty             Int              @default(0)
  price           Int              @default(0)
  purchaseOrderId Int
  purchaseOrder   Distro_PO_Header @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)

  @@map("Distro_PO_Line")
}

model Distro_PO_MasterItem {
  id          Int     @id @default(autoincrement())
  vehicle     String  @map("Vehicle")
  vehicleId   String  @map("VehicleID")
  category    String  @map("Category")
  productName String  @map("PRODUCT NAME")
  spType      String? @map("S_P_type")
  itemId      String  @unique @map("ITEMID")
  isActive    Boolean @default(true) @map("IsActive")

  @@map("Distro_PO_MasterItem")
}

// price removed; now handled in Distro_PO_MasterItem_Price_Line
model Distro_PO_MasterItem_Price_Header {
  id          String                            @id @default(uuid())
  description String
  createdAt   DateTime                          @default(now())
  createdBy   String
  updatedAt   DateTime                          @updatedAt
  priceLines  Distro_PO_MasterItem_Price_Line[]
}

model Distro_PO_MasterItem_Price_Line {
  id             Int                               @id @default(autoincrement())
  headerId       String
  header         Distro_PO_MasterItem_Price_Header @relation(fields: [headerId], references: [id], onDelete: Cascade)
  customerCode   String
  customerName   String
  itemId         String
  itemName       String
  price          Int
  activationDate DateTime
  createdAt      DateTime                          @default(now())
  updatedAt      DateTime                          @updatedAt
}

model Distro_PO_MasterAchievement {
  id           Int      @id @default(autoincrement())
  customerCode String   @map("Customer Code")
  customerName String   @map("Customer Name")
  city         String   @map("City")
  targetQty    Int      @map("Target QTY")
  targetAmount BigInt   @map("Target Amount")
  vehicle      String   @map("Vehicle")
  vehicleId    String   @map("Vechicle ID")
  periodYear   Int      @map("Period Year")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model FormL9 {
  formL9Id           String                    @id @default(uuid()) @db.Uuid
  companyId          String                    @unique @db.Uuid
  status             String                    @db.VarChar(50)
  createdAt          DateTime                  @default(now())
  updatedAt          DateTime                  @updatedAt
  company            Company                   @relation(fields: [companyId], references: [companyId], onDelete: Cascade)
  bankInfo           FormL9BankInfo?
  employeeInfo       FormL9Employe?
  generalInformation FormL9GeneralInformation?
  managements        FormL9Management[]
  others             FormL9Others?
  workExperiences    FormL9WorkExperience[]

  @@index([companyId])
  @@map("ebidding_form_l9")
}

model FormL9BankInfo {
  formL9BankInfoid   String   @id @default(uuid()) @db.Uuid
  formL9Id           String   @unique @db.Uuid
  beneficiaryName    String?
  beneficiaryAddress String?
  bankName           String?
  bankAddress        String?
  noRek              String?
  swiftCode          String?
  IBAN               String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  formL9             FormL9   @relation(fields: [formL9Id], references: [formL9Id], onDelete: Cascade)

  @@index([noRek])
  @@map("ebidding_form_l9_bank_info")
}

model FormL9GeneralInformation {
  formGeneralInformationId String                            @id @default(uuid()) @db.Uuid
  formL9Id                 String                            @unique @db.Uuid
  companyName              String?
  companyFoundingDate      DateTime?
  companyStatus            String?
  companyTelpFax           String?
  companyAddress           String?
  companyEmail             String?
  npwp                     String?
  totalCapital             String?
  segmentId                String?
  createdAt                DateTime                          @default(now())
  updatedAt                DateTime                          @updatedAt
  formL9                   FormL9                            @relation(fields: [formL9Id], references: [formL9Id], onDelete: Cascade)
  generalInfoContinue      FormL9GeneralInformationContinue?

  @@index([companyName])
  @@index([npwp])
  @@map("ebidding_form_l9_general_information")
}

model FormL9GeneralInformationContinue {
  formL9GeneralInformationContinueId String                   @id @default(uuid()) @db.Uuid
  formGeneralInformationId           String                   @unique @db.Uuid
  permitsHeld                        String?
  createdAt                          DateTime                 @default(now())
  updatedAt                          DateTime                 @updatedAt
  generalInformation                 FormL9GeneralInformation @relation(fields: [formGeneralInformationId], references: [formGeneralInformationId], onDelete: Cascade)

  @@map("ebidding_form_l9_general_information_continue")
}

model FormL9Management {
  formL9ManagementId String   @id @default(uuid()) @db.Uuid
  formL9Id           String   @db.Uuid
  position           String?
  name               String?
  noTelpFaxHp        String?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  formL9             FormL9   @relation(fields: [formL9Id], references: [formL9Id], onDelete: Cascade)

  @@index([formL9Id])
  @@index([name])
  @@index([position])
  @@map("ebidding_form_l9_management")
}

model FormL9Employe {
  formL9EmployeId String   @id @default(uuid()) @db.Uuid
  formL9Id        String   @unique @db.Uuid
  totalEmployees  Int?
  qualityControl  Int?
  engineering     Int?
  production      Int?
  management      Int?
  other           Int?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  formL9          FormL9   @relation(fields: [formL9Id], references: [formL9Id], onDelete: Cascade)

  @@map("ebidding_form_l9_employe")
}

model FormL9WorkExperience {
  formL9WorkExperienceId String   @id @default(uuid()) @db.Uuid
  formL9Id               String   @db.Uuid
  customerOrLocation     String?
  typeOfWork             String?
  score                  Int?
  customerContactPerson  String?
  customerTelpFaxHp      String?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  formL9                 FormL9   @relation(fields: [formL9Id], references: [formL9Id], onDelete: Cascade)

  @@index([formL9Id])
  @@index([customerOrLocation])
  @@index([typeOfWork])
  @@map("ebidding_form_l9_work_experience")
}

model FormL9Others {
  formL9OthersId                            String                 @id @default(uuid()) @db.Uuid
  formL9Id                                  String                 @unique @db.Uuid
  haveCertificateISO                        Boolean                @default(false)
  haveCompanyOrganizationalStructure        Boolean                @default(false)
  haveQualityControlOrganizationalStructure Boolean                @default(false)
  haveProductWarranty                       Boolean                @default(false)
  haveExpiryDate                            Boolean                @default(false)
  haveAPD                                   Boolean                @default(false)
  haveAPDRegulation                         Boolean                @default(false)
  isTopApplicable                           Boolean                @default(false)
  paymentTime                               String?
  agreeToConfidentialInformation            Boolean                @default(false)
  understandingBreachesOfConfidentiality    Boolean                @default(false)
  signConfidentialityAgreement              Boolean                @default(false)
  createdAt                                 DateTime               @default(now())
  updatedAt                                 DateTime               @updatedAt
  certificateISOs                           FormL9CertificateISO[]
  formL9                                    FormL9                 @relation(fields: [formL9Id], references: [formL9Id], onDelete: Cascade)

  @@map("ebidding_form_l9_others")
}

model FormL9CertificateISO {
  certificateISOId   String       @id @default(uuid()) @db.Uuid
  formL9OthersId     String       @db.Uuid
  isoName            String?
  validityPeriodFrom DateTime?
  validityPeriodTo   DateTime?
  remakes            String?
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
  others             FormL9Others @relation(fields: [formL9OthersId], references: [formL9OthersId], onDelete: Cascade)

  @@index([formL9OthersId])
  @@index([isoName])
  @@map("ebidding_form_l9_certificate_iso")
}

generator client {
  provider = "prisma-client-js"
  output   = "../@prisma/client-main"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model AllowedIpCors {
  ip String @unique @db.VarChar(50)

  @@index([ip])
}

model Menu {
  menuId            Int                 @id @default(autoincrement())
  sequence          Int
  parentId          Int?
  icon              String?             @db.VarChar(50)
  application       String              @default("E-Bidding") @db.VarChar(50)
  menuName          String              @db.VarChar(50)
  redirect          String
  isGlobal          Boolean             @default(false)
  isShow            Boolean             @default(true)
  isActive          Boolean             @default(true)
  UserHasRoleAccess UserHasRoleAccess[]
}

model User {
  userId              String              @id @default(uuid()) @db.Uuid
  email               String              @db.VarChar(150)
  application         String              @default("E-Bidding") @db.VarChar(150)
  password            String              @db.VarChar(255)
  isActive            Boolean             @default(false)
  sessionExpireDate   DateTime
  createdDate         DateTime            @default(now())
  updateDate          DateTime            @updatedAt
  blockedUntil        DateTime?
  failedLoginAttempts Int                 @default(0)
  linkedDevice        LinkedDevice[]
  logs                LogsLogin[]
  profile             Profile?
  ResetPassword       ResetPassword[]
  UserHasRoleAccess   UserHasRoleAccess[]
  otp                 otpVerifikasi[]

  @@unique([email, application])
  @@index([email])
  @@index([isActive])
  @@index([application])
  @@index([email, isActive])
}

model otpVerifikasi {
  id         Int      @id @default(autoincrement())
  userId     String   @db.Uuid
  code       String   @db.VarChar(6)
  expireDate DateTime
  user       User     @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@index([userId, code])
}

model LogsLogin {
  logsId      String   @id @default(uuid()) @db.Uuid
  userId      String   @db.Uuid
  token       String   @unique
  isActive    Boolean  @default(true)
  device      String?
  ip          String?  @db.VarChar(45)
  createdDate DateTime @default(now())
  expireDate  DateTime
  user        User     @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@index([userId])
}

model Role {
  roleId            Int                 @id @default(autoincrement())
  roleName          String              @db.VarChar(50)
  UserHasRoleAccess UserHasRoleAccess[]
}

model Access {
  accessId          Int                 @id @default(autoincrement())
  accessName        String              @db.VarChar(50)
  UserHasRoleAccess UserHasRoleAccess[]
}

model ResetPassword {
  resetId     String   @id @default(uuid()) @db.Uuid
  userId      String   @db.Uuid
  token       String   @default(uuid()) @db.Uuid
  createdDate DateTime @default(now())
  expireDate  DateTime
  user        User     @relation(fields: [userId], references: [userId], onDelete: Cascade)
}

model UserHasRoleAccess {
  userId   String @db.Uuid
  roleId   Int
  accessId Int
  menuId   Int?
  access   Access @relation(fields: [accessId], references: [accessId], onDelete: Cascade)
  menu     Menu?  @relation(fields: [menuId], references: [menuId], onDelete: Cascade)
  role     Role   @relation(fields: [roleId], references: [roleId], onDelete: Cascade)
  user     User   @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@id([userId, roleId, accessId])
  @@index([userId, accessId, menuId])
  @@index([userId, roleId, menuId])
  @@index([roleId, menuId])
  @@index([accessId, menuId])
  @@index([userId, menuId])
  @@index([roleId])
  @@index([userId])
  @@index([accessId])
  @@index([menuId])
}

model LinkedDevice {
  deviceId         String @id @default(uuid()) @db.Uuid
  clientDeviceUuid String @db.Uuid
  userId           String @db.Uuid
  user             User   @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@unique([userId, clientDeviceUuid])
  @@index([userId])
}

model Profile {
  userId    String   @id @db.Uuid
  companyId String?  @db.Uuid
  fullName  String   @db.VarChar(150)
  urlImage  String?
  phone     String   @db.VarChar(15)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  company   Company? @relation(fields: [companyId], references: [companyId], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [userId], onDelete: Cascade)

  @@index([userId, companyId])
  @@index([companyId])
  @@index([fullName])
}
